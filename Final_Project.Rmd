---
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE, 
                      cache = TRUE)
```

![](/Users/Egg/Desktop/Data-Science/Udacity/Columbia-Course/Stat-Visualization/Final-Project/4-22/LAPD.png)

<div style="background-color:#0d222b; text-align:center; font-size:18px;">
<span style="color:#FFFFFF">**Report on Crime Data in the City of Los Angeles <br> in Year 2017**</span>
</div>


**This dataset reflects incidents of crime in the City of Los Angeles dating back to 2010. This data is transcribed from original crime reports that are typed on paper and therefore there may be some inaccuracies within the data. Some location fields with missing data are noted as (0°, 0°). Address fields are only provided to the nearest hundred block in order to maintain privacy. This data is as accurate as the data in the database. Please note questions or concerns in the comments.**

<div style="background-color:#0d222b;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">OUTLINE</span>
</div>

Our team analysis LA crime data which is obtained from LAPD. The team members are: Xiqing Liu, Tianran Lu, Yixiang Cai, Jack Wang. Furthermore, our report contain following sections:

* Introduction
* Description of Data
* Analysis of Data Quality
* Main Analysis (Exploratory Data Analysis)
* Executive Summary with *Interactive Component*
* Conclusion


<div style="background-color:#0d222b;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">Introduction</span>
</div>

The main reason our team decide to work with crime data is because that deep concern about school shooting in USA. One surprising fact to point out, we are only 16 weeks into 2018, and there have already been 20 school shootings where someone was hurt or killed. That average out to **1.25** shootings a week. We feel sorry for those people lost their loved one in shooting accidents, and hope by doing this project report to raise people's attention to prevent this kind of misfortunate events to happen again.

However, there is very little shooting data that our team was managed to find. Based on those data is available online, it would be hard to produce an accurate and sophisticated report. That's the point we decide to change focus from specific shooting to more general crime data. There are, of course, a number of options available online. The primary reasons we finally decide to work with this one <a href=https://data.lacity.org/A-Safe-City/Crime-Data-from-2010-to-Present/y8tr-7khq>**(link)**</a> are:

* It is provided by LAPD
* Data is collected weekly
* Data has location columns (Latitude/Longitude)
* Relatively small amount of missing values

Given such a comprehensive dataset, we divide work into following ways:

1. Yixiang: Analyzing the relation between crime category and victim race, gender and environment temperature during the time.

2. Xiqing: Analyzing the geographic location and crime rate

3. Tianran: To understand the frequence of crime from time series perspective (week, month and year)

4. Jack: Overall report design and interactive components in each section

<div style="background-color:#0d222b;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">Description of Data</span>
</div>

The data is original provided by Los Angeles Police Department and it is availble to download at **data.lacity.org** <a href=https://data.lacity.org/A-Safe-City/Crime-Data-from-2010-to-Present/y8tr-7khq>**(link)**</a>. This data is transcribed from origianl crime reports that are typed on paper and therefore there may be some inaccurates within the set. Some location fields with missing data are noted as (0°, 0°). Address fields are only provided to the nearest hundred block in order to maintain privacy. This data is as accurate as the data in the database. 


<div style="background-color:#0d222b;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">Analysis of Data Quality</span>
</div>

The total size of the excel file is 400 MB. There are 26 columns and 1 million+ rows of information. Most of the missing values are: *Victim Age*, *Victim Sex*, *Victim Descent*, *Weapon Used Code*, *Weapon Description*, *Cross Street*.


```{r, echo=FALSE}
#Read in data
library(extracat)
library(tidyverse)
library(plotly)
library(scales)
library(RCurl)
library(bitops)
library(ggmap)
library(mapproj)
library(lubridate)
library(datetime)
library(recharts)
LA_2017 <- read.csv("/Users/Egg/Desktop/Data-Science/Udacity/Columbia-Course/Stat-Visualization/Final-Project/4-22/LA_2017.csv")

LA_2017_1 <- LA_2017
```


```{r, echo=FALSE, fig.width = 5, fig.height =5}
#Missing Value
visna(LA_2017)
```


The plot above provide a general understanding of the dataset. The next step will exclude those columns have no missing values. 


```{r, echo=FALSE, fig.width = 5, fig.height =5}
#Missing Value
Missing_Value <- LA_2017 %>%
  select(Victim.Age, Premise.Code, Weapon.Used.Code, Crime.Code.2, 
         Crime.Code.3, Crime.Code.4)
visna(Missing_Value)
```

<br>
We can see that there are four columns for Crime Code. That means a single crime can be classified in to at most four categories. We can see that for most records, the crime only belongs to one category. 

The column for Weapon Used also has many missing values, since there are some crimes that are not related to weapon or physical damage. We can see that the most common pattern for missing value in a single record is that the one with only one single Crime Code and with Weapon Used missing.

Since the features with large number of missing values happens to be the ones of less interest, for the purpose of analysis, we ignored those columns such as Crime Code with missing values and Weapon Used.
<br>


<div style="background-color:#0d222b;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">Main Analysis (Exploratory Data Analysis)</span>
</div>


<div style="background-color:#4aaad3;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">1. Crime Category V.S. Victim Race, Gender and Environment Temperature</span>
</div>

```{r message=F, include=FALSE}
df_crime <- LA_2017
df_weather=read.csv('/Users/Egg/Desktop/Data-Science/Udacity/Columbia-Course/Stat-Visualization/Final-Project/4-22/weather_2017.csv')

names(df_crime)
levels(factor(df_crime$Crime.Code.Description))
levels(factor(df_crime$Victim.Sex))

df_crime$Crime.Code.Description<-as.character(df_crime$Crime.Code.Description)
df_crime$Victim.Sex<-as.character(df_crime$Victim.Sex)
df_crime<-df_crime%>%
          select(Date.Occurred,
                 Victim.Sex,
                 Victim.Descent,
                 Crime.Code.Description)%>%
          filter((!is.na(Victim.Sex)) & (Victim.Sex!='X') & (Victim.Sex!=''))%>%
          filter(!is.na(Crime.Code.Description))%>%
          filter((!is.na(Victim.Descent)) & (Victim.Descent!='X') & (Victim.Descent!=''))
df_crime$Label <- as.numeric(df_crime$Victim.Descent)

Race_Number <- df_crime %>%
  select(Victim.Descent, Label) %>%
  distinct(Victim.Descent, Label)
Race_Number$Label <- as.character(Race_Number$Label)
```


```{r message=F, echo = FALSE}
deadly_assult<-df_crime%>%
  filter(grepl('DEADLY',`Crime.Code.Description`))%>%
  group_by(Victim.Descent)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))
deadly_assult <- merge(deadly_assult, Race_Number, by = "Victim.Descent", all.x = TRUE)

rape<-df_crime%>%
  filter(grepl('RAPE',Crime.Code.Description))%>%
  group_by(Victim.Descent)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))
rape <- merge(rape, Race_Number, by = "Victim.Descent", all.x = TRUE)

weapon<-df_crime%>%
  filter(grepl('BOMBING',Crime.Code.Description))%>%
  group_by(Victim.Descent)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))
weapon <- merge(weapon, Race_Number, by = "Victim.Descent", all.x = TRUE)

kidnap<-df_crime%>%
  filter(grepl('KIDNAPPING',Crime.Code.Description))%>%
  group_by(Victim.Descent)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))
kidnap <- merge(kidnap, Race_Number, by = "Victim.Descent", all.x = TRUE)

battery<-df_crime%>%
  filter(grepl('BATTERY',Crime.Code.Description))%>%
  group_by(Victim.Descent)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))
battery <- merge(battery, Race_Number, by = "Victim.Descent", all.x = TRUE)
```


```{r, message=F, fig.width = 5, fig.height =5}
p1<-ggplot(deadly_assult,aes(race,Num))+
  geom_col()+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('DEADLY ASSULT')
p1

p2<-ggplot(rape,aes(race,Num))+
  geom_col()+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('RAPE')
p2

p3<-ggplot(weapon,aes(race,Num))+
  geom_col()+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('WEAPONS/BOMBING')
p3

p4<-ggplot(kidnap,aes(race,Num))+
  geom_col()+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('KIDNAPPING')
p4

p5<-ggplot(battery,aes(race,Num))+
  geom_col()+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('BATTERY')
p5

```

We now look carefully at crimes of five category to see how the victims are related to the race. Those crimes are: Assult with deadly weapon, Rape, Kidnapping, Weapon/Bombing and Battery which we think are more likely to cause direct irreversible damage to the victims.

To note that the race coding is as follows:

A - Other Asian; B - Black; C - Chinese; D - Cambodian; F - Filipino; G - Guamanian; H - Hispanic/Latin/Mexican; I - American Indian/Alaskan Native; J - Japanese; K - Korean; L - Laotian; O - Other; P - Pacific; Islander; S - Samoan; U - Hawaiian; V - Vietnamese W - White; X - Unknown; Z - Asian Indian.

We can see that the proportion of Hispanic among the victims is generally high.
For assult with deadly weapon, the number of Hispanic victims is 5407, which is almost the sum of the rest. Black comes the second: 3290. Notice that the victims of assult with deadly weapon mainly concentrate in Black, White and Hispanic. Those account for more than 95% of the total number of victims.

For battery, the result appears to be in the same pattern: the proportion of Hispanic is overwhelmingly higher (9811/20725=47.3%), with White and Black coming next.

We can see that for the crimes that we are concerned, the number of Hispanic victims almost always come the highest with only one exception: Weapon/Bombing. Although this might be accounted by higher Hispanic population, it is necessary to call for the law enforcement department in LA to put more attention on the safety of Hispanic community.

```{r message=F, echo = FALSE}
deadly_assult2<-df_crime%>%
  filter(grepl('DEADLY',`Crime.Code.Description`))%>%
  filter(Victim.Sex %in% c('F','M')) %>%
  group_by(Victim.Descent,Victim.Sex)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))%>%
  group_by(race)%>%
  mutate(race_total=sum(Num))%>%ungroup()%>%
  mutate(Percent=round(Num/race_total,2))%>%
  mutate(f_Percent=ifelse(Victim.Sex=='F',Percent,1-Percent))%>%
  mutate(race_order=reorder(race,-f_Percent))


rape2<-df_crime%>%
  filter(grepl('RAPE',Crime.Code.Description))%>%
  group_by(Victim.Descent,Victim.Sex)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))%>%
  group_by(race)%>%
  mutate(race_total=sum(Num))%>%ungroup()%>%
  mutate(Percent=round(Num/race_total,2))%>%
  mutate(f_Percent=ifelse(Victim.Sex=='F',Percent,1-Percent))%>%
  mutate(race_order=reorder(race,-f_Percent))

weapon2<-df_crime%>%
  filter(grepl('BOMBING',Crime.Code.Description))%>%
  group_by(Victim.Descent,Victim.Sex)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))%>%
  group_by(race)%>%
  mutate(race_total=sum(Num))%>%ungroup()%>%
  mutate(Percent=round(Num/race_total,2))%>%
  mutate(f_Percent=ifelse(Victim.Sex=='F',Percent,1-Percent))%>%
  mutate(race_order=reorder(race,-f_Percent))

kidnap2<-df_crime%>%
  filter(grepl('KIDNAPPING',Crime.Code.Description))%>%
  group_by(Victim.Descent,Victim.Sex)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))%>%
  group_by(race)%>%
  mutate(race_total=sum(Num))%>%ungroup()%>%
  mutate(Percent=round(Num/race_total,2))%>%
  mutate(f_Percent=ifelse(Victim.Sex=='F',Percent,1-Percent))%>%
  mutate(race_order=reorder(race,-f_Percent))

battery2<-df_crime%>%
  filter(grepl('BATTERY',Crime.Code.Description))%>%
  filter(Victim.Sex!='H')%>%
  group_by(Victim.Descent,Victim.Sex)%>%
  summarise(Num=n())%>%
  mutate(race=reorder(Victim.Descent,-Num))%>%
  group_by(race)%>%
  mutate(race_total=sum(Num))%>%ungroup()%>%
  mutate(Percent=round(Num/race_total,2))%>%
  mutate(f_Percent=ifelse(Victim.Sex=='f',Percent,1-Percent))%>%
  mutate(m_Percent=ifelse(Victim.Sex=='M',Percent,1-Percent))%>%
  mutate(race_order=reorder(race,-m_Percent))
```



```{r message=F, echo = FALSE}

deadly_assult3<-df_crime%>%
  filter(grepl('DEADLY',Crime.Code.Description))%>%
  group_by(Date.Occurred)%>%
  summarise(Num=n())

assult_temp<-merge(deadly_assult3,df_weather,by.x='Date.Occurred',by.y='date')
assult_temp<-assult_temp%>%
  group_by(meantempm)%>%
  summarise(total_Num=sum(Num))

rape3<-df_crime%>%
  filter(grepl('RAPE',Crime.Code.Description))%>%
  group_by(Date.Occurred)%>%
  summarise(Num=n())

rape_temp<-merge(rape3,df_weather,by.x='Date.Occurred',by.y='date')
rape_temp<-rape_temp%>%
  group_by(meantempm)%>%
  summarise(total_Num=sum(Num))

weapon3<-df_crime%>%
  filter(grepl('BOMBING',Crime.Code.Description))%>%
  group_by(Date.Occurred)%>%
  summarise(Num=n())

weapon_temp<-merge(weapon3,df_weather,by.x='Date.Occurred',by.y='date')
weapon_temp<-weapon_temp%>%
  group_by(meantempm)%>%
  summarise(total_Num=sum(Num))

kidnap3<-df_crime%>%
  filter(grepl('KIDNAPPING',Crime.Code.Description))%>%
  group_by(Date.Occurred)%>%
  summarise(Num=n())

kidnap_temp<-merge(kidnap3,df_weather,by.x='Date.Occurred',by.y='date')
kidnap_temp<-kidnap_temp%>%
  group_by(meantempm)%>%
  summarise(total_Num=sum(Num))

battery3<-df_crime%>%
  filter(grepl('BATTERY',Crime.Code.Description))%>%
  group_by(Date.Occurred)%>%
  summarise(Num=n())

battery_temp<-merge(battery3,df_weather,by.x='Date.Occurred',by.y='date')
battery_temp<-battery_temp%>%
  group_by(meantempm)%>%
  summarise(total_Num=sum(Num))
```

<br>

```{r message=F, fig.width = 5, fig.height =5}
picture1<-ggplot(assult_temp,aes(x=meantempm,y=total_Num))+
  geom_bar(stat = 'identity')+
  xlab('Mean Temperature')+
  ylab('Number of Cases')+
  ggtitle('Deadly Assult vs Temperature')
picture1

picture2<-ggplot(rape_temp,aes(x=meantempm,y=total_Num))+
  geom_bar(stat = 'identity')+xlab('Mean Temperature')+
  ylab('Number of Cases')+
  ggtitle('Rape vs Temperature')
picture2

picture3<-ggplot(weapon_temp,aes(x=meantempm,y=total_Num))+
  geom_bar(stat = 'identity')+xlab('Mean Temperature')+
  ylab('Number of Cases')+
  ggtitle('Bombing vs Temperature')
picture3

picture4<-ggplot(kidnap_temp,aes(x=meantempm,y=total_Num))+
  geom_bar(stat = 'identity')+xlab('Mean Temperature')+
  ylab('Number of Cases')+
  ggtitle('Kidnapping vs Temperature')
picture4

picture5<-ggplot(battery_temp,aes(x=meantempm,y=total_Num))+
  geom_bar(stat = 'identity')+xlab('Mean Temperature')+
  ylab('Number of Cases')+
  ggtitle('Battery vs Temperature')
picture5

```

It is interesting to see that the histograms of Cime versus temperature all share the shape close to normal distribution. We can see that the occurance of crimes generally concentrate between 15 to 25 degress celcius. Crimes seem to have less preference in the days when it is very cold or hot.

<div style="background-color:#4aaad3;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">2. Geographic Location and Crime Rate</span>
</div>

```{r, echo=FALSE}
#Area name vs. crime count
area_name_count <- LA_2017 %>% group_by(Area.Name) %>% summarize(count = n())
AverageAreaCount <- round(mean(area_name_count$count),0)
```


```{r message=F, fig.width = 5, fig.height =5}
AreaNameCountPlotly <- ggplot(area_name_count, aes(reorder(Area.Name,count), count, fill = count))  + 
  geom_col() + 
  coord_flip() + 
  xlab("") + 
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13)) +
  geom_abline(intercept = AverageAreaCount, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = AverageAreaCount, xend = 22, yend = AverageAreaCount), colour = "red", size = 0.1)

AreaNameCountPlotly

```

Here we choose bar chart for the first step because the bar chart does very good job in showing and comparing counts for each category. In this bar chart, each bar stands for one area and the length of the bar shows how many crimes occurred in that area. The bars are in descending order. You can clearly see that the areas: “77th Street”, “Southwest”, “N Hollywood”, “Pacific” and “Southeast”. are ranked top 5 among all 21 areas. We also add a rea line which indicates the average count among all the areas. It is clear that there are 7 areas have the crime count more than average count, which are “77th Street”, “Southwest”, “N Hollywood”, “Pacific”, “Southeast”, “Mission” and “Northeast”. For the plot, the amount of crimes occurred in “77th Street” and “Southwest” are relatively much higher than other areas, which may be the reason why there are less than half of the number of areas have the number of crimes exceeds the average.


```{r, echo=FALSE}
area_name_count_gender <- LA_2017 %>% 
  filter(Victim.Sex %in% c('M', 'F')) %>%
  group_by(Area.Name, Victim.Sex) %>%
  summarize(count = n()) 

colnames(area_name_count_gender) <- c("Area.Name", "Victim.Sex", "Count")

AverageAreaCountGender <- round(sum(area_name_count_gender$Count)/21,0)
correctorder <- area_name_count_gender %>%
  ungroup() %>%
  filter(Victim.Sex == "M") %>%
  arrange(Count) %>%
  pull(Area.Name)
correctorder <- as.character(correctorder)

area_name_count_gender$Area.Name <- as.character(area_name_count_gender$Area.Name)
```

```{r message=FALSE}
AreaNameCountGenderPlotly <- area_name_count_gender %>%
  ungroup() %>%
  ggplot(aes(fct_relevel(Area.Name, correctorder), Count, fill = Victim.Sex))  +
  geom_bar(stat = "identity") +
  scale_fill_manual(values=c("#00B9F2","#8A8A8A")) +
  coord_flip() + 
  xlab("") + 
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13)) +
  geom_abline(intercept = AverageAreaCountGender, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = AverageAreaCountGender, xend = 22, yend = AverageAreaCountGender), colour = "red", size = 0.1)

AreaNameCountGenderPlotly

```


This plot shows the counts of crimes in each area facet on gender. Each bar is divided into two parts: Males (grey) and Females (blue). For most of the areas, the number of male victims is more than female victims except three areas: “Southwest”, “77th Street” and “Southeast”. By checking the map, these three areas are close to each other and located in in southern part of LA.

```{r message=FALSE, fig.width = 7, fig.height =7}
#Area Count facet by top 10 crimes
LA_2017_top10crime <- LA_2017 %>% 
  filter(Crime.Code.Description == c("BATTERY - SIMPLE ASSAULT", "VEHICLE - STOLEN", "BURGLARY FROM VEHICLE", "BURGLARY", "THEFT PLAIN - PETTY ($950 & UNDER)", "VANDALISM - FELONY ($400 & OVER, ALL CHURCH VANDALISMS) 0114", "INTIMATE PARTNER - SIMPLE ASSAULT", "THEFT OF IDENTITY", "ASSAULT WITH DEADLY WEAPON, AGGRAVATED ASSAULT", "THEFT FROM MOTOR VEHICLE - PETTY ($950 & UNDER)"))%>%
  arrange(Area.Name, Crime.Code.Description)

p <- LA_2017_top10crime %>%
  ungroup() %>%
  ggplot(aes(Area.Name))  + 
  geom_bar() + 
  coord_flip() + 
  xlab("") + 
  facet_wrap(~Crime.Code.Description, ncol=5) +
  theme_bw() +
  guides(fill = FALSE) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13),
        legend.background = element_rect(fill = alpha('white', 0.1)))
p
```


This plot is consisting of multiple bar charts. Each bar chart shows the crime counts among all the areas in LA for a particular crime type (Here, we only show the most frequently happened 10 crimes). From this plot, we can detect some information. First, the area “77th street”, almost all the crimes occurred most frequently in here compare to other areas. Second, different crimes most frequently happen in different areas. For example, we can clearly see that “ASSULT WITH DEADLY WEAPON, AGGRAVATED ASSULT”, “BATTERY – SIMPLE ASSULT”, “INTIMATE PARTNER – SIMPLE ASSULT” and “VEHICLE - STOLEN” most frequently happen in “77th Street” and “BURGLARY” most frequently happen in “Pacific” and “Denvonshire”. What’s more, “THEFT PLAIN – PETTY ($950 & UNDER)” most frequently happen in “Southwest” and “Pacific”.


```{r, echo=FALSE}
#Get Longitude and Latitude
LA_2017_seploc <- LA_2017 %>% extract(Location, c("Latitude", "Longitude"), "\\(([^,]+), ([^)]+)\\)")
LA_2017_seploc <- LA_2017_seploc[c("Latitude", "Longitude")]
LA_2017_seploc$crimeocc <- rep(1,nrow(LA_2017_seploc)) 
```


<div style="background-color:#4aaad3;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">3. Crime Data Time Series</span>
</div>

```{r, echo=FALSE}
LA_2017$Date.Occurred <- as.Date(LA_2017$Date.Occurred, "%m/%d/%Y")
LA_2017$Time.Occurred <- as.numeric(as.character(LA_2017$Time.Occurred))

to_hour <- function(x){
  hour = x %/% 100
  return (hour)
}

LA_2017$Time.Occurred <- to_hour(LA_2017$Time.Occurred)

mytheme <- theme_grey(18)
```


```{r fig.width = 15, fig.height = 3}
daily_crime_count <- LA_2017 %>% group_by(Date.Occurred) %>% summarize(Crime.Count = n())
ggplot(daily_crime_count, aes(x = Date.Occurred, y = Crime.Count)) + geom_col() + mytheme
```

<br>

#### Daily Crime Count of Year 2017 (Histogram)

* Y-axis is the daily crime count, X-axis is the occurred date in 2017.

<br>

```{r fig.width = 15, fig.height = 3}
g = ggplot(daily_crime_count, aes(x = Date.Occurred, y = Crime.Count)) + geom_line() + mytheme
g + geom_smooth(method = "loess", span = .05, se = FALSE) + ggtitle("Loess Smoother")
```

<br>

#### Daily Crime Count of Year 2017 with Loess Smoother

* Y-axis is the daily crime count, X-axis is the occurred date in 2017.
* Both graph show an extreme high crime count at the beginning of Jan 2017.
* There are also some periodic patterns throughout the year.

<br>

```{r fig.width = 15, fig.height = 2}
ggplot(daily_crime_count, aes(Date.Occurred, Crime.Count)) +
    geom_line() +
    facet_grid(.~month(Date.Occurred),scale = 'free_x')
```

<br>

#### Daily Crime Count Facet on Each Month.

* Number 1 to 12 corresponds to the 12 months.
* Y-axis is the daily crime count. X-axis is the day of month, from Day 1 to Day 31.

<br>

```{r fig.width = 15, fig.height = 2}
ggplot(daily_crime_count, aes(Date.Occurred, Crime.Count)) +
    geom_line() +
    facet_grid(.~lubridate::wday(Date.Occurred, label = TRUE)) +
    geom_smooth(se = FALSE,span = .2)
```

<br>

#### Daily Crime Count Facet on Day of Week with Loess Smoother

* Y-axis is the daily crime count. X-axis is the date occurred.
* extremely high crime count at the first Sunday of the year
* overall high crime count on Friday

<br>

```{r fig.width = 20, fig.height = 2}
ggplot(daily_crime_count, aes(Date.Occurred, Crime.Count)) +
    geom_line() +
    facet_grid(.~lubridate::mday(Date.Occurred)) +
    geom_smooth(se = FALSE)
```

<br>

#### Daily Crime Count Facet on Day of Month with Loess Smoother

* Number 1 to 31 corresponds to Day 1 to Day 31 in each month.
* Y-axis is the daily crime count. X-axis is the date occurred.
* extremely high crime count on the Day 1 of each month throughout the year.

<br>

```{r fig.width=25, fig.height= 5}
daily_crime_count2 <- LA_2017 %>% group_by(Date.Occurred,Time.Occurred) %>% summarize(Crime.Count = n())
ggplot(daily_crime_count2, aes(x = Date.Occurred, y = Crime.Count, group = 1)) + geom_line() +
    facet_grid(.~Time.Occurred) + geom_smooth(se = FALSE,span = .2)
```

<br>

#### Daily Crime Count Facet on 24 Hours of Each Day with Loess Smoother. (0h - 23h)

* Number 0 to 23 corresponds to 0hr - 23hr.
* Y-axis is the daily crime count. X-axis is the date occurred.
* overall high crime count at 12hr.

<br>

```{r fig.width=20, fig.height= 7}
ggplot(daily_crime_count2,aes(x = Date.Occurred, y = Crime.Count, group = 1)) + geom_line() +
  facet_grid(wday(Date.Occurred,label = TRUE)~Time.Occurred)
```

<br>

#### Daily Crime Count Facet on Day of Week and 24 Hours of Each Day. 

* Number 0 to 23 corresponds to 0hr - 23hr.
* Y-axis is the daily crime count. X-axis is the date occurred.
* large count and variance at 12hr; low count and variance at 5hr;
* intersting periodic pattern at 12hr throughout the week

<br>


```{r fig.width=20, fig.height= 5}
daily_crime_count2 %>% filter((mday(Date.Occurred) == 1) | (mday(Date.Occurred) == 11) | (mday(Date.Occurred) == 21)) %>%
  ggplot(aes(x = Date.Occurred, y = Crime.Count, group = 1)) + geom_line() +
    facet_grid(mday(Date.Occurred)~Time.Occurred)
```

<br>

#### Day 1, Day 11, Day 21 Daily Crime Count Facet on 24 Hours. 

* Number 0 to 23 corresponds to 0hr - 23hr. Number 1, 11, 21 correspond to Day 1, Day 11, Day 21.
* Y-axis is the daily crime count. X-axis is the date occurred.
* high crime count at 0hr Day 1, 8hr Day1 and 12hr Day 1

<br>


```{r fig.width=15, fig.height=7}
daily_crime_premise <- LA_2017 %>% group_by(Date.Occurred,Time.Occurred,Premise.Description) %>% summarize(Premise.Count = n())
premise_10 <- c('STREET','SINGLE FAMILY DWELLING','MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)','PARKING LOT','SIDEWALK','VEHICLE, PASSENGER/TRUCK','DRIVEWAY','GARAGE/CARPORT','RESTAURANT/FAST FOOD','DEPARTMENT STORE')
daily_crime_premise %>% filter(Premise.Description %in% premise_10) %>%
  ggplot(aes(x = Date.Occurred, y = Premise.Count, group = 1)) + geom_col() +
    facet_wrap(~Premise.Description, scales = 'free') + ylab('Crime.Count')
```

<br>

#### Daily Crime Count Facet on Top 10 Common Crime Premise.

* Y-axis is the daily crime count. X-axis is the date occurred.
* Top 10 Common Crime Premise is 'Department Store','Driveway','Garage/Carport','Multi-Unit Dwelling','Parking Lot','Restaurant/Fastfood','Sidewalk','Single Family Dwelling','Street','Vehicle, Passenger/Truck'. 'Other Business' is not included.

<br>

```{r fig.width=15, fig.height=7}
daily_crime_premise %>% filter(Premise.Description %in% premise_10) %>%
  ggplot(aes(x = Date.Occurred, y = Premise.Count, group = 1)) + geom_col() +
    facet_grid(Premise.Description~Time.Occurred, scales = 'free') + ylab('Crime.Count')
```

<br>

#### Daily Crime Count Facet on Top 10 Common Crime Premise and 24hrs.

* Number 0 to 23 corresponds to 0hr - 23hr.
* Y-axis is the daily crime count. X-axis is the date occurred.
* increasing overall patterns at Street, Sidewalk, Parking Lot, etc; up and down pattern at Dweling.

<br>


```{r fig.width=15, fig.height=7}
daily_crime_type <- LA_2017 %>% group_by(Date.Occurred,Time.Occurred,Crime.Code.Description) %>% summarize(Type.Count = n())
type_10 <- c('BATTERY WITH SEXUAL CONTACT','VEHICLE - STOLEN','BURGLARY FROM VEHICLE','BURGLARY','THEFT PLAIN - PETTY ($950 & UNDER)','VANDALISM - FELONY ($400 & OVER, ALL CHURCH VANDALISMS) 0114','INTIMATE PARTNER - SIMPLE ASSAULT','THEFT OF IDENTITY','ASSAULT WITH DEADLY WEAPON, AGGRAVATED ASSAULT','THEFT FROM MOTOR VEHICLE - PETTY ($950 & UNDER)')
daily_crime_type %>% filter(Crime.Code.Description %in% type_10) %>%
  ggplot(aes(x = Date.Occurred, y = Type.Count, group = 1)) + geom_col() +
    facet_wrap(~Crime.Code.Description,scales = 'free') + ylab('Crime.Count')
```

<br>

#### Daily Crime Count Facet on Top 10 Common Crime Type. 

* Y-axis is the daily crime count. X-axis is the date occurred.
* Top 10 Common Crime Type is 'Assault with Deadly Weapon','Battery with Sexual Contact','Burglary','Burglary from Vehicle','Intimate Partner - Simple Assault','Theft from Motor Vehicle - Petty','Theft of Identity','Theft Plain - Petty','Vandalism - Felony', 'Vehicle - Stolen'.

<br>

```{r fig.width=20, fig.height=10}
daily_crime_type %>% filter(Crime.Code.Description %in% type_10) %>%
  ggplot(aes(x = Date.Occurred, y = Type.Count, group = 1)) + geom_col() +
    facet_grid(Crime.Code.Description~Time.Occurred,scales = 'free') + ylab('Crime.Count')
```

<br>

#### Daily Crime Count Facet on Top 10 Common Crime Type and 24hrs.

* Number 0 to 23 corresponds to 0hr - 23hr.
* Y-axis is the daily crime count. X-axis is the date occurred.
* high crime count at 12hr for Theft; overall increasing pattern for Vehicle Stolen, etc.

<br>


<div style="background-color:#0d222b;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">Executive Summary with Interactive Component</span>
</div>

<div style="background-color:#4aaad3;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">1. Crime Category V.S. Victim Race, Gender and Environment Temperature</span>
</div>


```{r, message=F, echo=FALSE}
p1<-ggplot(deadly_assult,aes(race,Num, fill = Label))+
  geom_col()+#scale_fill_brewer(palette = 'BrBG')+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('DEADLY ASSULT')
p1<-ggplotly(p1, tooltip = c("race", "Num")) %>% 
  config(displayModeBar = F) %>%
  layout(showlegend = FALSE)
p1

p2<-ggplot(rape,aes(race,Num, fill = Label))+
  geom_col()+#scale_fill_brewer(palette='BrBG')+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('RAPE')
p2<-ggplotly(p2, tooltip = c("race", "Num")) %>% 
  config(displayModeBar = F) %>%
  layout(showlegend = FALSE)
p2

p3<-ggplot(weapon,aes(race,Num, fill = Label))+
  geom_col()+#scale_fill_brewer(palette='BrBG')+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('WEAPONS/BOMBING')
p3<-ggplotly(p3, tooltip = c("race", "Num")) %>% 
  config(displayModeBar = F) %>%
  layout(showlegend = FALSE)
p3

p4<-ggplot(kidnap,aes(race,Num, fill = Label))+
  geom_col()+#scale_fill_brewer(palette='BrBG')+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('KIDNAPPING')
p4<-ggplotly(p4, tooltip = c("race", "Num")) %>% 
  config(displayModeBar = F) %>%
  layout(showlegend = FALSE)
p4

p5<-ggplot(battery,aes(race,Num, fill = Label))+
  geom_col()+#scale_fill_brewer(palette='BrBG')+
  xlab('Victim Race')+ylab('Number of Cases')+
  ggtitle('BATTERY')
p5<-ggplotly(p5, tooltip = c("race", "Num")) %>% 
  config(displayModeBar = F) %>%
  layout(showlegend = FALSE)
p5

```

<br>

We now look carefully at crimes of five category to see how the victims are related to the race. Those crimes are: Assult with deadly weapon, Rape, Kidnapping, Weapon/Bombing and Battery which we think are more likely to cause direct irreversible damage to the victims.

To note that the race coding is as follows:

A - Other Asian; B - Black; C - Chinese; D - Cambodian; F - Filipino; G - Guamanian; H - Hispanic/Latin/Mexican; I - American Indian/Alaskan Native; J - Japanese; K - Korean; L - Laotian; O - Other; P - Pacific; Islander; S - Samoan; U - Hawaiian; V - Vietnamese W - White; X - Unknown; Z - Asian Indian.

We can see that the proportion of Hispanic among the victims is generally high.
For assult with deadly weapon, the number of Hispanic victims is 5407, which is almost the sum of the rest. Black comes the second: 3290. Notice that the victims of assult with deadly weapon mainly concentrate in Black, White and Hispanic. Those account for more than 95% of the total number of victims.

For battery, the result appears to be in the same pattern: the proportion of Hispanic is overwhelmingly higher (9811/20725=47.3%), with White and Black coming next.

We can see that for the crimes that we are concerned, the number of Hispanic victims almost always come the highest with only one exception: Weapon/Bombing. Although this might be accounted by higher Hispanic population, it is necessary to call for the law enforcement department in LA to put more attention on the safety of Hispanic community.

<br>

```{r message=F, echo=FALSE}
pic1<-ggplot(deadly_assult2)+
  geom_bar(aes(x=race_order,y=Percent,
               fill=factor(Victim.Sex,levels = c('M','F'))),stat="identity")+
  scale_fill_manual(values=c("#8A8A8A","#00B9F2")) +
  #scale_fill_brewer(palette = 'BrBG')+
  geom_text(aes(x = race_order, y = Percent, label = Num), 
            size = 3, position = position_stack(vjust = 0.51))+
  theme(legend.title=element_blank(),
        legend.background = element_rect(fill = alpha('white', 0.1)))+
  xlab('Victim Race')+ylab('Number of Cases')+
  geom_abline(intercept = 0.5, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = 0.5, xend = 13.5, yend = 0.5), colour = "red", size = 0.1) +
  ggtitle('DEADLY ASSULT')+coord_flip()
#pic1
ggplotly(pic1) %>% 
  config(displayModeBar = F) %>%
  layout(legend = list(orientation = "h", y = 1.1))


pic2<-ggplot(rape2)+
  geom_bar(aes(x=race_order,y=Percent,fill=factor(Victim.Sex,levels=c('M','F'))),
           stat="identity")+
  geom_text(aes(x=race_order,y=Percent,label=Num),
            size=3, position = position_stack(vjust=0.51))+
  scale_fill_manual(values=c("#8A8A8A","#00B9F2")) +
  #scale_fill_brewer(palette = 'BrBG')+
  theme(legend.title=element_blank(),
        legend.background = element_rect(fill = alpha('white', 0.1)))+
  xlab('Victim Race')+ylab('Number of Cases')+
  geom_abline(intercept = 0.5, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = 0.5, xend = 9.5, yend = 0.5), colour = "red", size = 0.1) +
  ggtitle('RAPE')+coord_flip()
#pic2
ggplotly(pic2) %>% 
  config(displayModeBar = F) %>%
  layout(legend = list(orientation = "h", y = 1.1))


pic3<-ggplot(weapon2)+
  geom_bar(aes(x=race_order,y=Percent,fill=factor(Victim.Sex,levels=c('M','F'))),stat="identity")+
  geom_text(aes(x=race_order,y=Percent,label=Num),
            size=3,position=position_stack(vjust = 0.51))+
  scale_fill_manual(values=c("#8A8A8A","#00B9F2")) +
  #scale_fill_brewer(palette = 'BrBG')+
  theme(legend.title=element_blank(),
        legend.background = element_rect(fill = alpha('white', 0.1)))+
  xlab('Victim Race')+ylab('Number of Cases')+
  geom_abline(intercept = 0.5, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = 0.5, xend = 4.5, yend = 0.5), colour = "red", size = 0.1) +
  ggtitle('WEAPONS/BOMBING')+coord_flip()
#pic3
ggplotly(pic3) %>% 
  config(displayModeBar = F) %>%
  layout(legend = list(orientation = "h", y = 1.1))


pic4<-ggplot(kidnap2)+
  geom_bar(aes(x=race_order,y=Percent,fill=factor(Victim.Sex,levels=c('M','F'))),stat="identity")+
  geom_text(aes(x=race_order,y=Percent,label=Num),
            size=3,position=(position_stack(vjust=0.45)))+
            #size=3,position=(position_nudge(y = 0.01)))+
  scale_fill_manual(values=c("#8A8A8A","#00B9F2")) +
  #scale_fill_brewer(palette = 'BrBG')+
  xlab('Victim Race')+ylab('Number of Cases')+
  theme(legend.title=element_blank(),
        legend.background = element_rect(fill = alpha('white', 0.1)))+
  geom_abline(intercept = 0.5, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = 0.5, xend = 5.5, yend = 0.5), colour = "red", size = 0.1) +
  ggtitle('KIDNAPPING')+coord_flip()
#pic4
ggplotly(pic4) %>% 
  config(displayModeBar = F) %>%
  layout(legend = list(orientation = "h", y = 1.1))

pic5<-ggplot(battery2)+
  geom_bar(aes(x=race_order,y=Percent,fill=factor(Victim.Sex,levels=c('M','F'))),stat="identity")+
  geom_text(aes(x=race_order,y=Percent,label=Num),
            size=3,position=position_stack(vjust=0.51))+
  scale_fill_manual(values=c("#8A8A8A","#00B9F2")) +
  #scale_fill_brewer(palette = 'BrBG')+
  theme(legend.title = element_blank(),
        legend.background = element_rect(fill = alpha('white', 0.1)))+
  xlab('Victim Race')+ylab('Number of Cases')+
  geom_abline(intercept = 0.5, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = 0.5, xend = 14.5, yend = 0.5), colour = "red", size = 0.1) +
  ggtitle('BATTERY')+coord_flip()
#pic5
ggplotly(pic5) %>% 
  config(displayModeBar = F) %>%
  layout(legend = list(orientation = "h", y = 1.1))

```


We also want to see the sex ratio of victims for each race. In order to keep the readers from getting misled by the minority group, the number of victims is also attached. For example, in battery, the female proportion of victim  for Hawaiian, Pacific Islander and Japanese is abnormally high: 100%, but the total number of the victims is less than five, which is far from being representative.

If we only focus on Hispanic, White and Black, we can observe a clear bias in sex for some crimes. 

For Assult with Deadly weapons and Bombing, the proportion of male victims is mostly two times that of female. On the other hand, for kidnapping and rape, females are more likely to be the target, especially rape where there is even hardly any male samples there.

In comparison, the result for Battery is a little out of expectation. Before doing the exploratory analysis, we expected a higher proportion in male victims since males are likely to be more aggressive than females. But it turned out that for Hispanic, Whit and Black, the proportion of male and female is pretty balanced.


```{r message=F, echo=FALSE}
picture1<-ggplot(assult_temp,aes(x=meantempm,y=total_Num, fill = total_Num))+
  geom_bar(stat = 'identity')+
  geom_smooth(colour = 'red', method = "loess", se=F, size = 0.3) +
  xlab('Mean Temperature')+
  ylab('Number of Cases')+
  ggtitle('Deadly Assult vs Temperature')
ggplotly(picture1) %>% 
  config(displayModeBar = F)

picture2<-ggplot(rape_temp,aes(x=meantempm,y=total_Num, fill = total_Num))+
  geom_bar(stat = 'identity')+xlab('Mean Temperature')+
  geom_smooth(colour = 'red', method = "loess", se=F, size = 0.3) +
  ylab('Number of Cases')+
  ggtitle('Rape vs Temperature')
ggplotly(picture2) %>% 
  config(displayModeBar = F)

picture3<-ggplot(weapon_temp,aes(x=meantempm,y=total_Num, fill = total_Num))+
  geom_bar(stat = 'identity')+xlab('Mean Temperature')+
  ylab('Number of Cases')+
  ggtitle('Bombing vs Temperature')
ggplotly(picture3) %>% 
  config(displayModeBar = F)

picture4<-ggplot(kidnap_temp,aes(x=meantempm,y=total_Num, fill = total_Num))+
  geom_bar(stat = 'identity')+xlab('Mean Temperature')+
  geom_smooth(colour = 'red', method = "loess", se=F, size = 0.3) +
  ylab('Number of Cases')+
  ggtitle('Kidnapping vs Temperature')
ggplotly(picture4) %>% 
  config(displayModeBar = F)

picture5<-ggplot(battery_temp,aes(x=meantempm,y=total_Num, fill = total_Num))+
  geom_bar(stat = 'identity')+xlab('Mean Temperature')+
  geom_smooth(colour = 'red', method = "loess", se=F, size = 0.3) +
  ylab('Number of Cases')+
  ggtitle('Battery vs Temperature')
ggplotly(picture5) %>% 
  config(displayModeBar = F)

```

It is interesting to see that the histograms of Cime versus temperature all share the shape close to normal distribution. We can see that the occurance of crimes generally concentrate between 15 to 25 degress celcius. Crimes seem to have less preference in the days when it is very cold or hot.

<div style="background-color:#4aaad3;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">2. Geographic Location and Crime Rate</span>
</div>

```{r, echo=FALSE, fig.height=6, fig.width=10}
#plot 1
#Geofacet(Not done!)
library(geofacet)
mygrid <- data.frame(
  row = c(3, 3, 4, 4, 4, 4, 4, 5, 5, 6, 6, 6, 6, 6, 6, 7, 7, 11, 8, 8, 8),
  col = c(6, 2, 5, 4, 3, 7, 10, 7, 2, 9, 6, 8, 3, 4, 7, 10, 9, 8, 8, 7, 10),
  code = c("Foothill", "Devonshire", "N Hollywood", "West Valley", "Van Nuys", "Hollywood", "Northeast", "Central", "Topanga", "Mission", "Olympic", "Rampart", "Pacific", "West LA", "Wilshire", "Hollenbeck", "Newton", "Harbor", "77th Street", "Southwest", "Southeast"),
  name = c("Foothill", "Devonshire", "N Hollywood", "West Valley", "Van Nuys", "Hollywood", "Northeast", "Central", "Topanga", "Mission", "Olympic", "Rampart", "Pacific", "West LA", "Wilshire", "Hollenbeck", "Newton", "Harbor", "77th Street", "Southwest", "Southeast"),
  stringsAsFactors = TRUE)
grid_preview(mygrid)
```

<br>

First, we want to deal with the variable “Area.Name” which indicates where the crimes occurred. There are totally 21 areas have crimes occurred. Below is a geofacet map which can show there relatively location in LA.


<br>

```{r, echo=FALSE}
#plot 2
AreaNameCountPlotly <- ggplot(area_name_count, aes(reorder(Area.Name,count), count, fill = count))  + 
  geom_col() + 
  coord_flip() + 
  xlab("") + 
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13)) +
  geom_abline(intercept = AverageAreaCount, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = AverageAreaCount, xend = 22, yend = AverageAreaCount), colour = "red", size = 0.1)

ggplotly(AreaNameCountPlotly)%>% 
  config(displayModeBar = F)
```

<br>

Here we choose bar chart because the bar chart does very good job in showing and comparing counts for each category. In this bar chart, each bar stands for one area and the length of the bar shows how many crimes occurred in that area. The bars are in descending order. You can clearly see that the areas: “77th Street”, “Southwest”, “N Hollywood”, “Pacific” and “Central”. are ranked top 5 among all 21 areas. We also add a rea line which indicates the average count among all the areas. It is clear that there are 9 areas have the crime count more than average count, which are “77th Street”, “Southwest”, “N Hollywood”, “Pacific”, “Central”, “Southeast”, “Newton”, “Hollywood”, “Olympic”, “Mission” and “Topanga”. For the plot, the amount of crimes occurred in “77th Street” and “Southwest” are relatively much higher than other areas, which may be the reason why there are less than half of the number of areas have the number of crimes exceeds the average.


<br>

```{r, echo=FALSE}
#plot 3
area_name_count_gender <- LA_2017 %>% 
  filter(Victim.Sex %in% c('M', 'F')) %>%
  group_by(Area.Name, Victim.Sex) %>%
  summarize(count = n()) #%>%
  #mutate(Percentage = round(n / sum(n), digits = 3))
colnames(area_name_count_gender) <- c("Area.Name", "Victim.Sex", "Count")

AverageAreaCountGender <- round(sum(area_name_count_gender$Count)/21,0)
correctorder <- area_name_count_gender %>%
  ungroup() %>%
  filter(Victim.Sex == "M") %>%
  arrange(Count) %>%
  pull(Area.Name)
correctorder <- as.character(correctorder)

area_name_count_gender$Area.Name <- as.character(area_name_count_gender$Area.Name)

AreaNameCountGenderPlotly <- area_name_count_gender %>%
  ungroup() %>%
  #ggplot(aes(Area.Name, Count, fill = Victim.Sex))  + 
  ggplot(aes(fct_relevel(Area.Name, correctorder), Count, fill = Victim.Sex))  +
  geom_bar(stat = "identity") +
  scale_fill_manual(values=c("#00B9F2","#8A8A8A")) +
  coord_flip() + 
  xlab("") + 
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13)) +
  geom_abline(intercept = AverageAreaCountGender, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = AverageAreaCountGender, xend = 22, yend = AverageAreaCountGender), colour = "red", size = 0.1)

ggplotly(AreaNameCountGenderPlotly)%>% 
  config(displayModeBar = F)

```

<br>

This plot shows the counts of crimes in each area facet on gender. Each bar is divided into two parts: Males (grey) and Females (blue). For most of the areas, the number of male victims is more than female victims except three areas: “Southwest”, “77th Street” and “Southeast”. By checking the map, these three areas are close to each other and located in in southern part of LA.

<br>

```{r, echo=FALSE}
#plot 4
LA_2017$Date.Occurred <- as.Date(LA_2017$Date.Occurred, "%m/%d/%Y")
LA_2017$Month.Occurred <- month(LA_2017$Date.Occurred)

area_name_wordcloud <- LA_2017 %>% 
  group_by(Month.Occurred, Area.Name) %>% 
  summarize(count = n()) %>%
  arrange(Month.Occurred, count)

g <- echartr(area_name_wordcloud, Area.Name, count, t=Month.Occurred, type='wordCloud') %>%
  setTheme('dark', palette = 'manyeyes')
g
```

<br>

After that, we want to generate several word clouds. Why we choose word clouds is because “word cloud” is a very good visual representation of detecting the words appear most frequently. The frequency and importance of each area name are shown with different font size and colors. We generate the word clouds according to month. By clicking each month on the timeline, you can see the word cloud of area names. For each month, there are several area names appears to be bigger than other names, which means these names are the ones appears the most frequently in the data and those areas are where the crimes happen the most frequently. 

<br>

```{r, echo=FALSE, fig.width = 12, fig.height = 22}
#plot 5
crime_type_count <- LA_2017 %>% group_by(Crime.Code.Description) %>% summarize(count = n())
CrimeTypeCount <- round(mean(crime_type_count$count),0)

CrimeTypeCountPlotly <- ggplot(crime_type_count, aes(reorder(Crime.Code.Description,count), count, fill = count))  +
  geom_col() + 
  coord_flip() + 
  xlab("") + 
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13),
        legend.background = element_rect(fill = alpha('white', 0.1))) +
  geom_abline(intercept = CrimeTypeCount, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = CrimeTypeCount, xend = 139.5, yend = CrimeTypeCount), colour = "red", size = 0.1)

ggplotly(CrimeTypeCountPlotly)%>% 
  config(displayModeBar = F)
```

<br>

Here we also choose bar chart for showing the counts of each crime type. In this bar chart, each bar stands for one type of crime and the length of the bar shows the number of this type of crime occurred. The bars are also in descending order because it is very easy to see which type of crime occurred the most frequently. “BATTERY – SIMPLE ASSULT”, ”, “VEHICLE - STOLEN”, “BURGLARY FROM VEHICLE”, “BURGLARY” and “THEFT PLAIN – PETTY ($950 & UNDER)” are the top 5 crimes that occur most frequently in LA. The red line indicates the average count among all the crimes. The top 25 crimes have the frequency more than the average number among all 142 types of crimes, from which we can know that the number of crime occurred do not distributed evenly. There are some types of crime occur much more often than other crimes but there are more types of crimes have relatively lower frequency.


<br>

```{r, echo=FALSE, fig.width = 12, fig.height = 5}
#plot 6
crime_type_count_top_10 <- crime_type_count %>% top_n(10)

CrimeTypeCount_Top10 <- round(mean(crime_type_count_top_10$count),0)

CrimeTypeCountPlotly_Top10 <- ggplot(crime_type_count_top_10, aes(reorder(Crime.Code.Description,count), count, fill = count))  +
  geom_col(width = 0.5, binwidth = 0.5) + 
  coord_flip() + 
  xlab("") + 
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13),
        legend.background = element_rect(fill = alpha('white', 0.1))) +
  geom_abline(intercept = CrimeTypeCount_Top10, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = CrimeTypeCount_Top10, xend = 11, yend = CrimeTypeCount_Top10), colour = "red", size = 0.1)

ggplotly(CrimeTypeCountPlotly_Top10) %>% 
  config(displayModeBar = F)
```

<br>

We pick the top 10 crime which have the most frequency and made a bar chart. “BATTERY – SIMPLE ASSULT” is the one occurs most frequently in LA. 

<br>

```{r, echo=FALSE, fig.height=3, fig.width=10}
#plot 7
#Top 10 facet by gender
LA_2017_top10crime_gender <- LA_2017_top10crime %>% 
  filter(Victim.Sex==c("F", "M")) %>%
  group_by(Crime.Code.Description, Victim.Sex) %>%
  summarise(Count = n())

LA_Top10_Gender <- round(sum(LA_2017_top10crime_gender$Count)/10,0)

correctorderGENDER <- LA_2017_top10crime_gender %>%
  ungroup() %>%
  filter(Victim.Sex == "M") %>%
  arrange(Count) %>%
  pull(Crime.Code.Description)

correctorderGENDER <- as.character(correctorderGENDER)

LA_2017_top10crime_gender$Crime.Code.Description <- as.character(LA_2017_top10crime_gender$Crime.Code.Description)


AreaNameCountGenderPlot <- LA_2017_top10crime_gender %>%
  ungroup() %>%
  ggplot(aes(fct_relevel(Crime.Code.Description, correctorderGENDER), Count, fill = Victim.Sex))  + 
  #ggplot(aes(fct_relevel(Area.Name, correctorder), Count, fill = Victim.Sex))  +
  geom_bar(stat = "identity") +
  scale_fill_manual(values=c("#00B9F2","#8A8A8A")) +
  coord_flip() + 
  xlab("") + 
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13)) +
  geom_abline(intercept = LA_Top10_Gender, slope = 0, colour = "red", size = 0.3) +
  geom_segment(aes(x = 1, y = LA_Top10_Gender, xend = 10, yend = LA_Top10_Gender), colour = "red", size = 0.1)

ggplotly(AreaNameCountGenderPlot)%>% 
  config(displayModeBar = F)

```

<br>

By “faceting” on gender, we get more information from the data. For most of these 10 most frequently crimes, the number of male victims and the number of female victims do not differ much. There are three crimes that show relatively more difference between the number of male victims and female victims. For “BURGLARY”, the number of male victims is as 1.5 times as the number of female victims. The crime “ASSULT WITH DEADLY WEAPON, AGGRAVATED ASSULT”, the number of male victims is as twice as the number of female victims. The crime “INTIMATE PARTNER – SIMPLE ASSULT”, the females are the main victims, which is as four times as the number of male victims.

<br>

```{r, echo=FALSE, fig.width = 7, fig.height =7}
#plot 8
#Area Count facet by top 10 crimes
LA_2017_top10crime <- LA_2017 %>% 
  filter(Crime.Code.Description == c("BATTERY - SIMPLE ASSAULT", "VEHICLE - STOLEN", "BURGLARY FROM VEHICLE", "BURGLARY", "THEFT PLAIN - PETTY ($950 & UNDER)", "VANDALISM - FELONY ($400 & OVER, ALL CHURCH VANDALISMS) 0114", "INTIMATE PARTNER - SIMPLE ASSAULT", "THEFT OF IDENTITY", "ASSAULT WITH DEADLY WEAPON, AGGRAVATED ASSAULT", "THEFT FROM MOTOR VEHICLE - PETTY ($950 & UNDER)"))%>%
  arrange(Area.Name, Crime.Code.Description)

p <- LA_2017_top10crime %>%
  ungroup() %>%
  ggplot(aes(Area.Name, fill = Crime.Code.Description))  + 
  geom_bar() + 
  coord_flip() + 
  xlab("") + 
  facet_wrap(~Crime.Code.Description, ncol=5) +
  theme_bw() +
  guides(fill = FALSE) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        plot.margin = margin(0,0,5,9),
        plot.title = element_text(hjust = 1, size = 13),
        legend.background = element_rect(fill = alpha('white', 0.1)))
p
```


This plot is consisting of multiple bar charts. Each bar chart shows the crime counts among all the areas in LA for a particular crime type (Here, we only show the most frequently happened 10 crimes). From this plot, we can detect some information. First, the area “77th street”, almost all the crimes occurred very frequently in here compare to other areas. Second, different crimes most frequently happen in different areas. For example, we can clearly see that “ASSULT WITH DEADLY WEAPON, AGGRAVATED ASSULT”, “INTIMATE PARTNER – SIMPLE ASSULT” and “VEHICLE - STOLEN” most frequently happen in “77th Street” and “BURGLARY” most frequently happen in “West LA”. What’s more, “THEFT PLAIN – PETTY ($950 & UNDER)” most frequently happen in “Central” and “Pacific”.


```{r message=FALSE, echo=FALSE}
#plot 9
#How crimes spread in LA
LAnew <- LA_2017_seploc %>% 
  filter(Longitude != "0.0", Latitude != "0.0")

LAnew$Latitude <- as.numeric(LAnew$Latitude)
LAnew$Longitude <- as.numeric(LAnew$Longitude)
LAnew$crime <- as.character(LAnew$crimeocc)

map <- get_map(location = c(lon = -118.4, lat = 34.0522), zoom = 11, maptype = "hybrid")
#location = 'los angeles'
#, source = 'google', color = 'color')
ggmap(map) + geom_point(aes(x = Longitude, y = Latitude, color = "red", show_guide = TRUE), size = 0.1, data = LAnew, alpha = 0.2, na.rm = T) 
  #scale_colour_manual(values = c("1" = "yellow")) + 
  #scale_color_gradient(low = "beige", high = "blue")
```


For visualizing the crimes, we downloaded the map raster from google map and plotted the raster and overlay the data. We plotted the data by using their longitude as the x-coordinate and latitude as the y-coordinate. By adjusting the alpha, which is the transparency of the points, you can clearly see where appears more points and where appears less. By using the map, you can see that around longitude -118.3 and latitude 34.0, more points gather there, which means that area is where the crimes occur most frequently. This matches what we get from the “Area Count Bar Chart”: 77th Street is the area where most crimes occurred.


```{r message=FALSE, echo=FALSE}
#plot 10
#Heat map is good at detecting spread of the crimes
ggmap(map) + 
  geom_density2d(data = LAnew, 
    aes(x = Longitude, y = Latitude), size = 0.8) + 
  stat_density2d(data = LAnew, 
    aes(x = Longitude, y = Latitude, fill = ..level.., alpha = ..level..), size = 0.01, 
    bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", high = "red") + 
  scale_alpha(range = c(0, 1), guide = FALSE)
```


To improve the scatter plot, we decide to perform a 2D kernel density heat map as well as displaying the contours. Heat map is a very good graphical representation to display the clusters of points. It helps a lot when you want to locate the center of the area where the most points lied in. In our case, we define the density level from low to high as “green” to “red”. The place with most crimes occurred is in red in the heat map.

Here are the heat maps of five selected crimes people may pay more attention on:

#### ASSULT WITH DEADLY WEAPON, AGGRAVATED ASSULT
<div style="margin-left: 50px; margin-top:20px;">
```{r message=FALSE, echo=FALSE}
LA_2017_ass_seploc <- LA_2017 %>% 
  filter(Crime.Code.Description == "ASSAULT WITH DEADLY WEAPON, AGGRAVATED ASSAULT") %>% 
  extract(Location, c("Latitude", "Longitude"), "\\(([^,]+), ([^)]+)\\)")
LA_2017_ass_seploc <- LA_2017_ass_seploc[c("Latitude", "Longitude")]
LA_2017_ass_seploc$crimeocc <- rep(1,nrow(LA_2017_ass_seploc)) 
LAnew_ass<- LA_2017_ass_seploc %>% filter(Longitude != "0.0", Latitude != "0.0")
LAnew_ass$Latitude <- as.numeric(LAnew_ass$Latitude)
LAnew_ass$Longitude <- as.numeric(LAnew_ass$Longitude)
LAnew_ass$crime <- as.character(LAnew_ass$crimeocc)

ggmap(map) + 
  geom_density2d(data = LAnew_ass, 
    aes(x = Longitude, y = Latitude), size = 0.8) + 
  stat_density2d(data = LAnew_ass, 
    aes(x = Longitude, y = Latitude, fill = ..level.., alpha = ..level..), size = 0.01, 
    bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", high = "red") + 
  scale_alpha(range = c(0, 1), guide = FALSE)
```
</div>


#### Kidnapping
<div style="margin-left: 50px; margin-top:20px;">
```{r message=FALSE, echo=FALSE}
LA_2017_kid_seploc <- LA_2017 %>% 
  filter(Crime.Code.Description == "KIDNAPPING") %>% 
  extract(Location, c("Latitude", "Longitude"), "\\(([^,]+), ([^)]+)\\)")
LA_2017_kid_seploc <- LA_2017_kid_seploc[c("Latitude", "Longitude")]
LA_2017_kid_seploc$crimeocc <- rep(1,nrow(LA_2017_kid_seploc)) 
LAnew_kid <- LA_2017_kid_seploc %>% filter(Longitude != "0.0", Latitude != "0.0")
LAnew_kid$Latitude <- as.numeric(LAnew_kid$Latitude)
LAnew_kid$Longitude <- as.numeric(LAnew_kid$Longitude)
LAnew_kid$crime <- as.character(LAnew_kid$crimeocc)

ggmap(map) + 
  geom_density2d(data = LAnew_kid, 
    aes(x = Longitude, y = Latitude), size = 0.8) + 
  stat_density2d(data = LAnew_kid, 
    aes(x = Longitude, y = Latitude, fill = ..level.., alpha = ..level..), size = 0.01, 
    bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", high = "red") + 
  scale_alpha(range = c(0, 1), guide = FALSE)
```
</div>


#### Rape, Forcible
<div style="margin-left: 50px; margin-top:20px;">
```{r message=FALSE, echo=FALSE}
LA_2017_rape_seploc <- LA_2017 %>% 
  filter(Crime.Code.Description == "RAPE, FORCIBLE") %>% 
  extract(Location, c("Latitude", "Longitude"), "\\(([^,]+), ([^)]+)\\)")
LA_2017_rape_seploc <- LA_2017_rape_seploc[c("Latitude", "Longitude")]
LA_2017_rape_seploc$crimeocc <- rep(1,nrow(LA_2017_rape_seploc)) 
LAnew_rape <- LA_2017_rape_seploc %>% filter(Longitude != "0.0", Latitude != "0.0")
LAnew_rape$Latitude <- as.numeric(LAnew_rape$Latitude)
LAnew_rape$Longitude <- as.numeric(LAnew_rape$Longitude)
LAnew_rape$crime <- as.character(LAnew_rape$crimeocc)

ggmap(map) + geom_density2d(data = LAnew_rape, 
    aes(x = Longitude, y = Latitude), size = 0.8) + stat_density2d(data = LAnew_rape, 
    aes(x = Longitude, y = Latitude, fill = ..level.., alpha = ..level..), size = 0.01, 
    bins = 16, geom = "polygon") + scale_fill_gradient(low = "green", high = "red") + 
    scale_alpha(range = c(0, 1), guide = FALSE)
```
</div>



#### WEAPONS POSSESSION/BOMBING
<div style="margin-left: 50px; margin-top:20px;">
```{r message=FALSE, echo=FALSE}
LA_2017_bom_seploc <- LA_2017 %>% 
  filter(Crime.Code.Description == "WEAPONS POSSESSION/BOMBING") %>% 
  extract(Location, c("Latitude", "Longitude"), "\\(([^,]+), ([^)]+)\\)")
LA_2017_bom_seploc <- LA_2017_bom_seploc[c("Latitude", "Longitude")]
LA_2017_bom_seploc$crimeocc <- rep(1,nrow(LA_2017_bom_seploc)) 
LAnew_bom <- LA_2017_bom_seploc %>% filter(Longitude != "0.0", Latitude != "0.0")
LAnew_bom$Latitude <- as.numeric(LAnew_bom$Latitude)
LAnew_bom$Longitude <- as.numeric(LAnew_bom$Longitude)
LAnew_bom$crime <- as.character(LAnew_bom$crimeocc)

ggmap(map) + geom_density2d(data = LAnew_bom, 
    aes(x = Longitude, y = Latitude), size = 0.8) + stat_density2d(data = LAnew_bom, 
    aes(x = Longitude, y = Latitude, fill = ..level.., alpha = ..level..), size = 0.01, 
    bins = 16, geom = "polygon") + scale_fill_gradient(low = "green", high = "red") + 
    scale_alpha(range = c(0, 1), guide = FALSE)
```
</div>


#### BATTERY
<div style="margin-left: 50px; margin-top:20px;">
```{r, echo=FALSE}
LA_2017_bat_seploc <- LA_2017 %>% 
  filter(Crime.Code.Description == "BATTERY - SIMPLE ASSAULT") %>% 
  extract(Location, c("Latitude", "Longitude"), "\\(([^,]+), ([^)]+)\\)")
LA_2017_bat_seploc <- LA_2017_bat_seploc[c("Latitude", "Longitude")]
LA_2017_bat_seploc$crimeocc <- rep(1,nrow(LA_2017_bat_seploc)) 
LAnew_bat<- LA_2017_bat_seploc %>% filter(Longitude != "0.0", Latitude != "0.0")
LAnew_bat$Latitude <- as.numeric(LAnew_bat$Latitude)
LAnew_bat$Longitude <- as.numeric(LAnew_bat$Longitude)
LAnew_bat$crime <- as.character(LAnew_bat$crimeocc)

ggmap(map) + 
  geom_density2d(data = LAnew_bat, 
    aes(x = Longitude, y = Latitude), size = 0.8) + 
  stat_density2d(data = LAnew_bat, 
    aes(x = Longitude, y = Latitude, fill = ..level.., alpha = ..level..), size = 0.01, 
    bins = 16, geom = "polygon") + 
  scale_fill_gradient(low = "green", high = "red") + 
  scale_alpha(range = c(0, 1), guide = FALSE)
```
</div>

<div style="background-color:#4aaad3;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">3. Crime Data Time Series</span>
</div>

```{r, echo=FALSE}
LA_2017_1$Date.Occurred <- as.Date(LA_2017_1$Date.Occurred, "%m/%d/%Y")
LA_2017_1$Time.Occurred <- as.numeric(as.character(LA_2017_1$Time.Occurred))
to_hour <- function(x){
  hour = x %/% 100
  return (hour)
}
LA_2017_1$Time.Occurred <- to_hour(LA_2017_1$Time.Occurred)
```


```{r, echo=FALSE}
daily_crime_count <- LA_2017_1 %>% 
  group_by(Date.Occurred) %>% 
  summarize(Crime.Count = n())
daily_crime_count["wday"] <- factor(wday(daily_crime_count$Date.Occurred,label=TRUE))
daily_crime_count["month"] <- factor(month(daily_crime_count$Date.Occurred),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
daily_crime_count["day"] <- factor(mday(daily_crime_count$Date.Occurred),labels=c('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'))
daily_crime_count["yday"] <- as.numeric(as.character(yday(daily_crime_count$Date.Occurred)))
```


```{r, echo=FALSE}
titles <- '2017 Daily Crime Count'
title_style <- textStyle(fontFamily='Courier New', fontSize=16, color='#2E2E2E')
styLine <- lineStyle(color='#CD4F39', width=0.8)
itemStyle <- list(normal=itemStyle(lineStyle=styLine))
echartr(daily_crime_count, Date.Occurred, Crime.Count,type='line') %>% 
  setSymbols('none') %>% 
  setSeries(itemStyle=itemStyle) %>% 
  setXAxis(name="Date Occurred") %>% 
  setYAxis(name="Number of Crime") %>% 
  setTitle(titles,textStyle=title_style)
```

<br>

#### Daily Crime Count of Year 2017

* Y-axis is the daily crime count, X-axis is the occurred date. 
* The time series plot has peaks at 1/27, 2/26, 3/31, 5/3, 5/27, 6/6, 7/4, 7/31, 9/1, 10/25, 11/3, 12/1, 12/16. The daily number of crime reaches maximum at 9/1, which is 904. 
* The time series plot has an overall up and down trend. It has a slightly increasing trend before September and an obvious decreasing pattern after Septempber. 

<br>

```{r, echo=FALSE}
titles <- 'Daily Crime Count Facet on Month'
echartr(daily_crime_count, day, Crime.Count, month, type='line') %>%
    setSymbols('none') %>% setTheme('blue') %>% setXAxis(name="Day of Month") %>% setYAxis(name="Number of Crime")%>% setTitle(titles)
```

<br>

#### Daily Crime Count Facet on Each Month.

* Y-axis is the daily crime count. X-axis is the day of month, from Day 1 to Day 31. 

<br>

```{r, echo=FALSE}
#title_style <- textStyle(fontFamily='Courier New', fontSize=16, color='#607B8B')
titles <- 'Crime Count Facet on Day of Week'
echartr(daily_crime_count, Date.Occurred, Crime.Count, wday,type='line') %>%
    setSymbols('none') %>% setTheme('blue') %>% setXAxis(name="Date Occurred") %>% setYAxis(name="Number of Crime")%>% setTitle(titles)
```

<br>

#### Daily Crime Count Facet on Day of Week.

* Y-axis is the daily crime count. X-axis is occurred date.

<br>

```{r, echo=FALSE}
titles <- rep('Daily Crime Count Facet on Month',12)
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#607B8B')),time=12)
styLine <- lineStyle(color='lightcoral', width=1.5)
itemStyle <- list(normal=itemStyle(lineStyle=styLine,color='lightslategrey'))
echartr(daily_crime_count, day, Crime.Count, t=month,type='line',subtype = 'smooth') %>% setYAxis(max=1100,min = 500,name="Number of Crime") %>%setXAxis(name="Day of Month")%>% setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#607B8B', fontFamily='Courier New',fontSize=12,fontWeight='bold'))) %>% setSymbols('none')%>% setSymbols('emptyCircle') %>% setSeries(itemStyle=itemStyle)%>% setTitle(titles,textStyle=title_style)
```

<br>

#### Daily Crime Count Facet on Each Month.

* i.e. The first plot shows the daily crime count versus the occurred date in January.
* Y-axis is the daily crime count. X-axis is the day of month, from Day 1 to Day 31. 
* Recharts timeline provides a reasonable way to show the plot facet on date/time components such as week, month, hours, minutes, etc. By showing the plot with the natural time order of the date/time components, one can easily observe the overall trends and detect abnomral patterns.
* Most of months have a relative flat trend arount 620, while Mar, May, Oct, Dec have larger variances. 
* The average count for Jul is slightly higher than the other months. 
* The crime count of 1st day of almost all the months are higher than the rest, especaily in Jan and Sep. Jan 1st, 2017 shows an significantly high value of crime count. 

<br>

```{r, echo=FALSE}
titles <- rep('Daily Crime Count Facet on Day of Week',7)

title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#607B8B')),time=7)

styLine <- lineStyle(color='lightslategray', width=1.5)

itemStyle <- list(normal=itemStyle(lineStyle=styLine,color='#FFA54F'))

echartr(daily_crime_count, yday, Crime.Count, t=wday, type='curve') %>% 
  setYAxis(max=1100,min = 500,name="Number of Crime")%>% 
  setXAxis(min = 0, max = 365,name="Day of Year")%>% setSymbols('none') %>% 
  setSymbols('emptyCircle') %>% setSeries(itemStyle=itemStyle) %>% 
  setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#607B8B', fontFamily='Courier New',fontSize=12,fontWeight='bold')),
    data=c('Sun','Mon','Tue','Wed','Thu','Fri','Sat')) %>% setTitle(titles,textStyle=title_style)
```

<br>

#### Daily Crime Count Facet on Day of Week.

* i.e. The first plot shows the daily crime count versus the Sunday of each weak in year 2017.
* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365. 
* Regardless of the peaks, the average daily crime count of Friday is higher than the others and the average daily crime count of Sunday is relatively lower.
* Daily crime count of Sunday has a large peak on day 1; Monday has peak between day 100 and day 130; Tuesday has two peaks around day 200 and day 310; Wednesday has several peaks before day 80 and after day 300, the pattern in between is relatively more flat; Thursday has two peaks around day 150 and day 230; Friday has more peaks and shows large fluctuations; Saturday shows relatively more flat trend and decreases at the end.

<br>

```{r, echo=FALSE}
titles=c()
for (i in 1:31)
  titles <- c(titles,paste0('Daily Crime Count Facet on Day of Month (Day ',as.character(i),')'))
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#607B8B')),time=24)
styLine <- lineStyle(color='#53868B', width=1.5)#,shadowBlur=5, shadowColor='lightblue')
itemStyle <- list(normal=itemStyle(lineStyle=styLine,color='salmon'))
#itemStyle <- list(normal=itemStyle(lineStyle=styLine))
echartr(daily_crime_count, yday, Crime.Count, t=day, type='line',subtype = 'smooth') %>% setYAxis(max=1100,min = 500, name = 'Number of Crime') %>% setXAxis(min = 0, max = 365, name = 'Day of Year') %>% setTimeline(playInterval=800)%>% setSymbols('emptyCircle') %>% setSeries(itemStyle=itemStyle) %>% setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#607B8B', fontFamily='Courier New',fontSize=11,fontWeight='bold'))) %>% setTitle(titles,textStyle=title_style)
```

<br>

#### Daily Crime Count Facet on Day of Month.

* i.e. The first plot shows the daily crime count versus the 1st day of each month in year 2017.
* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365. 
* The average daily crime count of 1st day of each month is significantly larger than the others. Most of the days show a relative flat pattern around 620. Some days show small peaks such as day 26 and some mild fluctuations. Regardless of day 1, there is no significant difference and obvious trend between the rest of days. 

<br>

```{r, echo=FALSE}
daily_crime_count2 <- LA_2017_1 %>% group_by(Date.Occurred,Time.Occurred) %>% summarize(Crime.Count = n())
daily_crime_count2["wday"] <- factor(wday(daily_crime_count2$Date.Occurred,label=TRUE))
daily_crime_count2["month"] <- factor(month(daily_crime_count2$Date.Occurred),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
daily_crime_count2["day"] <- factor(mday(daily_crime_count2$Date.Occurred),labels=c('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'))
daily_crime_count2["yday"] <- as.numeric(as.character(yday(daily_crime_count2$Date.Occurred)))
daily_crime_count2$Time.Occurred <- factor(daily_crime_count2$Time.Occurred, labels=c('0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23'))
```


```{r, echo=FALSE}
titles=c()
for (i in 0:23)
  titles <- c(titles,paste0('Daily Crime Count Facet on 24hrs (',as.character(i),'h)'))
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#607B8B')),time=24)

styLine <- lineStyle(color='#F08080', width=0.5)#,shadowBlur=5, shadowColor='lightblue')
itemStyle <- list(normal=itemStyle(lineStyle=styLine))
echartr(daily_crime_count2, yday, Crime.Count, t=Time.Occurred, type='curve') %>% setYAxis(max=150,min = 0,name="Number of Crime") %>% setXAxis(min = 0, max = 365, name = "Day of Year") %>% setSymbols('none') %>% setSeries(itemStyle=itemStyle) %>%  setSeries(timeslots='12', itemStyle=list(normal=itemStyle(lineStyle=lineStyle(color='#B03060')))) %>%
    setSeries(timeslots='13', itemStyle=itemStyle) %>% setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#607B8B', fontFamily='Courier New',fontSize=11,fontWeight='bold')),
    data=c('0h','1h','2h','3h','4h','5h','6h','7h','8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h','19h','20h','21h','22h','23h')) %>% setTitle(titles,textStyle=title_style)
```

<br>

#### Daily Crime Count Facet on 24 Hours of Each Day. (0h - 23h)

* i.e. The first plot shows the daily crime count versus the 0h of each day in year 2017.
* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365.
* The average daily crime count of 12h is significantly higher than the rest with obvious periodic patterns. (The plot of 12h is colored by dark red.) 
* 3h, 4h, 5h, 6h have a low average daily crime count with relative flat pattern with small fluctuation whereas 13h-23h and 1h have relative large variance with higher average daily crime count. Regardless of 12h, the plot has an overall ascending trend from 4h to 22h, then descends from 23h to 2h.
* 8h shows a periodic pattern before day 160; 0h and 12h have obvious periodic pattern throughout the year. The peaks in plot 12h is much higher than that in 8h and 0h.

<br>

```{r, echo=FALSE}
titles <- rep('0h,5h,12h Daily Crime Count Facet on Day of Week',7)
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#8B6969')),time=7)
styLine <- lineStyle(width=1.2)
itemStyle <- list(normal=itemStyle(lineStyle=styLine))
daily_crime_count2_new <- subset(daily_crime_count2,(Time.Occurred=='12')| (Time.Occurred=='0') | (Time.Occurred=='5'))
daily_crime_count2_new$Time.Occurred <- factor(daily_crime_count2_new$Time.Occurred)
echartr(daily_crime_count2_new, yday, Crime.Count, Time.Occurred,t=wday,type='curve') %>%
    setTitle('') %>% setTheme(palette=c('#CD9B9B','#EEB4B4', '#8B6969')) %>%
    setSymbols('emptyCircle')%>% setXAxis(min = 0, max = 365, name="Day of Year") %>% setYAxis(min = 0, max = 150, name="Number of Crime")%>% setSeries(itemStyle=itemStyle)%>% setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#BC8F8F', fontFamily='Courier New',fontSize=12,fontWeight='bold')),
    data=c('Sun','Mon','Tue','Wed','Thu','Fri','Sat')) %>% setTitle(titles,textStyle=title_style)
```

<br>

#### 0h, 5h, and 12h Daily Crime Count Facet on Day of Week. 

* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365.
* 0h, 5h and 12h are chosen because in plot 'Daily Crime Count Facet on 24 hours', 5h has the lowest average daily crime count and variance; 0h has slightly higher average daily crime count and variance, also shows an relatively obvious periodic pattern; 12h has the highest average daily crime count and variance, shows significant periodic pattern.
* The plot of 5h has relatively low values and fluctuation.
* Both 12h and 5h have significant high crime counts on the first Sundays of the year; 12h and 5h also share similar periodic pattern across the week. For instance, they have similar peaks around Sunday day 280, Monday day 120, Tuesday day 200, Wednesday day 30 day 65 day 210, Thursday day 155, Friday day 250 day 330, Saturday day 90 day 180.
* Regardless of the peaks, the value of Sunday of 12h is relatively low than other day of week. One can observe an obvious increase trend of overall pattern when transition from Sunday to Monday in 12h.

<br>

```{r, echo=FALSE}
titles=c()
for (i in 0:23)
  titles <- c(titles,paste0('1st,11th,21st Daily Crime Count Facet on 24hrs (',as.character(i),'h)'))
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#2F4F4F')),time=24)

styLine <- lineStyle(width=1.2)
itemStyle <- list(normal=itemStyle(lineStyle=styLine))
daily_crime_count2_new2 <- daily_crime_count2 %>% filter((day == '1') | (day == '11') | (day == '21'))
daily_crime_count2_new2$day <- factor(daily_crime_count2_new2$day)
echartr(daily_crime_count2_new2, yday, Crime.Count, day,t=Time.Occurred,type='curve') %>% setTheme(palette=c('#2F4F4F','#528B8B', '#79CDCD')) %>%
    setSymbols('emptyCircle')%>% setXAxis(min = 0, max = 365,name='Day of Year', splitNumber=5) %>% setYAxis(min = 0, max = 140,name='Number of Crime') %>% setSeries(itemStyle=itemStyle)%>% setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#607B8B', fontFamily='Courier New',fontSize=11,fontWeight='bold')),
    data=c('0h','1h','2h','3h','4h','5h','6h','7h','8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h','19h','20h','21h','22h','23h')) %>% setTitle(titles,textStyle=title_style)
```

<br>

#### Day 1, Day 11, Day 21 Daily Crime Count Facet on 24 Hours. 

* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365.
* Day 1, Day 11, Day 21 are chosen because in plot 'Daily Crime Count Facet on Day of Month', Day 1 shows abnormal patterns (much higher) compared with the rest. Day 11 and Day 21 are chosen to represent the month and used as benchmarks. 
* Day 1 is relatively much higher than Day 11 and Day 21 in 0h, 8h and 12h. 
  + In 0h plot, Day 1 has a pretty high crime count at Jan 1 2017, a small peak at Apr 1 2017 and a mild fluctuation at the remaining of time. Regardless of value at Jan 1 2017, the differences between Day 1 and Day 11, Day 21 stay basically the same. 
  + In 8h plot, Day 1 has an overall slightly decreasing trend with a small variance. It reaches the minimum value at Oct 1 2017. There is also a decreasing trend of the differencs between Day 1 and Day 11 Day 21. (increase a little at November and December) 
  + In 12h plot, Day 1 has an obvious descending trend and a periodic pattern every 3 months (expect for January 1 which is also very high). Since both Day 11 and Day 21 have an overall ascending trend, the differences become smaller throughout the year. On the rest of the timestamp, Day 1 has basically the same range values and variance as Day 11 and Day 21.

<br>

```{r, echo=FALSE}
daily_crime_premise <- LA_2017_1 %>% group_by(Date.Occurred,Premise.Description) %>% summarize(Premise.Count = n())
premise_10 <- c('STREET','SINGLE FAMILY DWELLING','MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)','PARKING LOT','SIDEWALK','VEHICLE, PASSENGER/TRUCK','DRIVEWAY','GARAGE/CARPORT','RESTAURANT/FAST FOOD','DEPARTMENT STORE')
daily_crime_premise_new <- daily_crime_premise %>% filter(Premise.Description %in% premise_10)
daily_crime_premise_new$Premise.Description <- factor(daily_crime_premise_new$Premise.Description)
daily_crime_premise_new["wday"] <- factor(lubridate::wday(daily_crime_premise_new$Date.Occurred,label=TRUE))
daily_crime_premise_new["month"] <- factor(month(daily_crime_premise_new$Date.Occurred),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
daily_crime_premise_new["day"] <- factor(mday(daily_crime_premise_new$Date.Occurred),labels=c('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'))
daily_crime_premise_new["yday"] <- as.numeric(as.character(yday(daily_crime_premise_new$Date.Occurred)))
#daily_crime_premise_new$Time.Occurred <- factor(daily_crime_premise_new$Time.Occurred, labels=c('0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23'))
```

```{r, echo=FALSE}
itemStyle <- list(normal=itemStyle(color='#C1CDCD'))
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#2F4F4F')),time=10)
titles <- c('Department Store','Driveway','Garage/Carport','Multi-Unit Dwelling','Parking Lot','Restaurant/Fastfood','Sidewalk','Single Family Dwelling','Street','Vehicle, Passenger/Truck')
echartr(daily_crime_premise_new, yday,Premise.Count, t=Premise.Description,type='column')%>% setSeries(barWidth=1) %>% setSeries(itemStyle=itemStyle) %>% setXAxis(min = 0, max = 365, name="Day of Year") %>% setYAxis(name="Number of Crime") %>% 
  setTimeline(playInterval=800,symbol='emptyCircle', label=labelStyle(textStyle=textStyle( color='#6E7B8B', fontFamily='Courier New',fontSize=12,fontWeight='bold')),
data=c('D','Dr', 'G', 'Dw(M)','P','R/F','S','Dw(S)','S','V')) %>% setTitle(title = titles, textStyle=title_style)
```

<br>

#### Daily Crime Count Facet on Top 10 Common Crime Premise.

* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365.
* Top 10 Common Crime Premise is 'Department Store','Driveway','Garage/Carport','Multi-Unit Dwelling','Parking Lot','Restaurant/Fastfood','Sidewalk','Single Family Dwelling','Street','Vehicle, Passenger/Truck'. 'Other Business' is not included.
* Both multi-unit and single family dwelling is relatively constant throughout the year; There is an obvious up and down trend in Sidewalk plot with the maximum around day 200. The other crime premises have larger fluctuation. 

<br>

```{r, echo=FALSE}
daily_crime_premise2 <- LA_2017_1 %>% group_by(Date.Occurred,Time.Occurred,Premise.Description) %>% summarize(Crime.Count = n())
premise_10 <- c('STREET','SINGLE FAMILY DWELLING','MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)','PARKING LOT','SIDEWALK','VEHICLE, PASSENGER/TRUCK','DRIVEWAY','GARAGE/CARPORT','RESTAURANT/FAST FOOD','DEPARTMENT STORE')
daily_crime_premise_new2 <- daily_crime_premise2 %>% filter(Premise.Description %in% premise_10)
daily_crime_premise_new2$Premise.Description <- factor(daily_crime_premise_new2$Premise.Description)
daily_crime_premise_new2["wday"] <- factor(lubridate::wday(daily_crime_premise_new2$Date.Occurred,label=TRUE))
daily_crime_premise_new2["month"] <- factor(month(daily_crime_premise_new2$Date.Occurred),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
daily_crime_premise_new2["day"] <- factor(mday(daily_crime_premise_new2$Date.Occurred),labels=c('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'))
daily_crime_premise_new2["yday"] <- as.numeric(as.character(yday(daily_crime_premise_new2$Date.Occurred)))
daily_crime_premise_new2$Time.Occurred <- factor(daily_crime_premise_new2$Time.Occurred, labels=c('0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23'))
```

```{r, echo=FALSE}
titles=c()
for (i in 0:23)
  titles <- c(titles,paste0('Street (',as.character(i),'h)'))
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#2F4F4F')),time=24)

itemStyle <- list(normal=itemStyle(color='#C1CDCD'))
daily_crime_premise_street <- daily_crime_premise_new2 %>% filter(Premise.Description=='STREET')
daily_crime_premise_street$Premise.Description <- factor(daily_crime_premise_street$Premise.Description)
echartr(daily_crime_premise_street, yday, Crime.Count,t=Time.Occurred,type='column')%>%
    setSymbols('none')%>% setXAxis(min = 0, max = 365, name="Day of Year") %>% setYAxis(min = 0, max = 30, name="Number of Crime")%>% setSeries(itemStyle=itemStyle,barWidth=1)%>% setTimeline(playInterval=800) %>%
setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#6E7B8B', fontFamily='Courier New',fontSize=11,fontWeight='bold')),
    data=c('0h','1h','2h','3h','4h','5h','6h','7h','8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h','19h','20h','21h','22h','23h')) %>% setTitle(titles,textStyle=title_style)
```

<br>

#### Street Daily Crime Count Facet on 24 Hours (0h - 23h). 

* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365.
* The Street Daily Crime Count ascends from 3h to 22h and descends from 23h to 2h.

<br>

```{r, echo=FALSE}
titles=c()
for (i in 0:23)
  titles <- c(titles,paste0('Single Family Dwelling (',as.character(i),'h)'))

itemStyle1 <- list(normal=itemStyle(color='#C1CDCD'))
itemStyle2 <- list(normal=itemStyle(color='#96CDCD'))
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#2F4F4F')),time=24)
daily_crime_premise_dwelling <- daily_crime_premise_new2 %>% filter(Premise.Description=='SINGLE FAMILY DWELLING')
daily_crime_premise_dwelling$Premise.Description <- factor(daily_crime_premise_dwelling$Premise.Description)
echartr(daily_crime_premise_dwelling, yday, Crime.Count,t=Time.Occurred,type='column') %>%
    setSymbols('none')%>% setXAxis(min = 0, max = 365, name="Day of Year") %>% setYAxis(min = 0, max = 30,name="Number of Crime")%>% setSeries(itemStyle=itemStyle1,barWidth=1) %>% setGrid(width=650) %>% setSeries(timeslots='12', itemStyle=itemStyle2) %>% setSeries(timeslots='13', itemStyle=itemStyle1)%>% setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#607B8B', fontFamily='Courier New',fontSize=11,fontWeight='bold')),
    data=c('0h','1h','2h','3h','4h','5h','6h','7h','8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h','19h','20h','21h','22h','23h')) %>% setTitle(titles,textStyle=title_style)
```

<br>

#### Single Family Dwelling Daily Crime Count Facet on 24 Hours (0h - 23h). 

* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365.
* Average daily dwelling crime count has small peaks at 0h, 8h, and a significant large peak at 12h, which is indicated by a brighter color. It also has an overall ascending pattern before 12h. There is no obvious patterns between 13h and 23h.

<br>

```{r, echo=FALSE}
daily_crime_type <- LA_2017_1 %>% group_by(Date.Occurred,Crime.Code.Description) %>% summarize(Type.Count = n())
type_10 <- c('BATTERY WITH SEXUAL CONTACT','VEHICLE - STOLEN','BURGLARY FROM VEHICLE','BURGLARY','THEFT PLAIN - PETTY ($950 & UNDER)','VANDALISM - FELONY ($400 & OVER, ALL CHURCH VANDALISMS) 0114','INTIMATE PARTNER - SIMPLE ASSAULT','THEFT OF IDENTITY','ASSAULT WITH DEADLY WEAPON, AGGRAVATED ASSAULT','THEFT FROM MOTOR VEHICLE - PETTY ($950 & UNDER)')
daily_crime_type_new <- daily_crime_type %>% filter(Crime.Code.Description %in% type_10)
daily_crime_type_new$Crime.Code.Description <- factor(daily_crime_type_new$Crime.Code.Description)
daily_crime_type_new["wday"] <- factor(lubridate::wday(daily_crime_type_new$Date.Occurred,label=TRUE))
daily_crime_type_new["month"] <- factor(month(daily_crime_type_new$Date.Occurred),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
daily_crime_type_new["day"] <- factor(mday(daily_crime_type_new$Date.Occurred),labels=c('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'))
daily_crime_type_new["yday"] <- as.numeric(as.character(yday(daily_crime_type_new$Date.Occurred)))
```


```{r, echo=FALSE}
itemStyle <- list(normal=itemStyle(color='#CDB7B5'))
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#2F4F4F')),time=10)
titles <- c('Assault with Deadly Weapon','Battery with Sexual Contact','Burglary','Burglary from Vehicle','Intimate Partner - Simple Assault','Theft from Motor Vehicle - Petty','Theft of Identity','Theft Plain - Petty','Vandalism - Felony', 'Vechicle - Stolen')
echartr(daily_crime_type_new, yday,Type.Count, t=Crime.Code.Description,type='column')%>% setSeries(barWidth=1) %>% setSeries(itemStyle=itemStyle) %>% setXAxis(min = 0, max = 365, name="Day of Year") %>% setYAxis(name="Number of Crime") %>% 
  setTimeline(playInterval=800,symbol='emptyCircle', label=labelStyle(textStyle=textStyle( color='#6E7B8B', fontFamily='Courier New',fontSize=12,fontWeight='bold')),
data=c('A','BS','B','BV','I','TV','T','TP','V','VS')) %>% setTitle(title = titles, textStyle=title_style)
```

<br>

#### Daily Crime Count Facet on Top 10 Common Crime Type. 

* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365.
* Top 10 Common Crime Type is 'Assault with Deadly Weapon','Battery with Sexual Contact','Burglary','Burglary from Vehicle','Intimate Partner - Simple Assault','Theft from Motor Vehicle - Petty','Theft of Identity','Theft Plain - Petty','Vandalism - Felony', 'Vechicle - Stolen'.
* Assault with Deadly Weapon has two small speaks around day 170 and day 290. It also shows an up and down trend throughout the year.
* Intimate Partner - Simple Assult has a slightly up and down trend.
* Theft of Identity is has several perodic patterns. It is especailly high at Jan 1, 2017.

<br>

```{r, echo=FALSE}
daily_crime_type2 <- LA_2017_1 %>% group_by(Date.Occurred,Time.Occurred,Crime.Code.Description) %>% summarize(Crime.Count = n())
type_10 <- c('BATTERY WITH SEXUAL CONTACT','VEHICLE - STOLEN','BURGLARY FROM VEHICLE','BURGLARY','THEFT PLAIN - PETTY ($950 & UNDER)','VANDALISM - FELONY ($400 & OVER, ALL CHURCH VANDALISMS) 0114','INTIMATE PARTNER - SIMPLE ASSAULT','THEFT OF IDENTITY','ASSAULT WITH DEADLY WEAPON, AGGRAVATED ASSAULT','THEFT FROM MOTOR VEHICLE - PETTY ($950 & UNDER)')
daily_crime_type_new2 <- daily_crime_type2 %>% filter(Crime.Code.Description %in% type_10)
daily_crime_type_new2$Crime.Code.Description <- factor(daily_crime_type_new2$Crime.Code.Description)
daily_crime_type_new2["wday"] <- factor(lubridate::wday(daily_crime_type_new2$Date.Occurred,label=TRUE))
daily_crime_type_new2["month"] <- factor(month(daily_crime_type_new2$Date.Occurred),labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
daily_crime_type_new2["day"] <- factor(mday(daily_crime_type_new2$Date.Occurred),labels=c('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'))
daily_crime_type_new2["yday"] <- as.numeric(as.character(yday(daily_crime_type_new2$Date.Occurred)))
daily_crime_type_new2$Time.Occurred <- factor(daily_crime_type_new2$Time.Occurred, labels=c('0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23'))
```

```{r, echo=FALSE}
titles=c()
for (i in 0:23)
  titles <- c(titles,paste0('Vehicle Stolen (',as.character(i),'h)'))
title_style <- rep(list(textStyle(fontFamily='Courier New', fontSize=16, color='#2F4F4F')),time=24)

itemStyle <- list(normal=itemStyle(color='#CDB7B5'))
daily_crime_type_v <- daily_crime_type_new2 %>% filter(Crime.Code.Description=='VEHICLE - STOLEN')
daily_crime_type_v$Crime.Code.Description <- factor(daily_crime_type_v$Crime.Code.Description)
echartr(daily_crime_type_v, yday, Crime.Count,t=Time.Occurred,type='column')%>%
    setSymbols('none')%>% setXAxis(min = 0, max = 365, name="Day of Year") %>% setYAxis(min = 0, max = 15, name="Number of Crime")%>% setSeries(itemStyle=itemStyle,barWidth=1)%>% setTimeline(playInterval=800) %>%
setTimeline(playInterval=800,symbol='emptyCircle',label=labelStyle(textStyle=textStyle(
    color='#6E7B8B', fontFamily='Courier New',fontSize=11,fontWeight='bold')),
    data=c('0h','1h','2h','3h','4h','5h','6h','7h','8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h','19h','20h','21h','22h','23h')) %>% setTitle(titles,textStyle=title_style)
```

<br>

#### Vehicle Stolen Daily Crime Count Facet on 24 Hours.

* Y-axis is the daily crime count. X-axis is the day of year, from day 1 to day 365.
* An obvious increasing trend after 12h.

<br>

<div style="background-color:#0d222b;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">Conclusion</span>
</div>

#### Limitations & Lessons Learned

* First of all, we really wish to thank you for spending your time to finish reading this report. We are aware it is long, however our team wish to present you the data as detail as possible. Because all these aspects of analysis will be critical for you to develope a comprehensive understanding of what we did.

* Another thing that we would like to improve is to create a Shiny & Leaflet map of Los Angeles crime data. What we have right now are some static maps plot using ggmap. Nevertheless, with the functionality of Shiny would allow readers to choose filter(s)/dimension(s) that seem most interested to them. 

* The Wordcloud is also an area that our team would like to improve. The one we have right now is cool to look, but variation between the difference is not significant. Part of the reason is because the data itself, also the package (recharts) that we used to create this has very limited parameters to tune. This really prevent us of delivering a more satisfactory product. Our team is interested in developing R package by ourselves to do a better work.

* Even though we have use lots of Javascript in our work, we fail to implement D3 into our project. We are aware of the amount of freedom D3 would provide readers as it allow more interactive in between.

#### Future Directions
In the End, we would like to come back to the topic of school shooting. It's remarkable how easy it is to relate to the experience of a school shooting. Nowaday, for parents, each news break threatens the already fragile social trust required to leave your child with strangers all day, even when the violence is thousands of miles away. It is easy to make each tragedy our own.

Our team believe there is still a lot of potential in this dataset to understand about LA crime. Even using only 6-8 attributes out of 27, we manage to produce a report like this. At this point, the semester is almost over, but we would like to continue to work on this dataset. Because we truly believe, people need to know more about the dangerous around them. Thank you very much for your time!

<div style="background-color:#0d222b;text-align:left;font-size:18px;">
<span style="color:#FFFFFF;font-weight:bold;margin-left:2px">Reference</span>
</div>
#### LA Crime Data from 2010 to Present
<a href=https://data.lacity.org/A-Safe-City/Crime-Data-from-2010-to-Present/y8tr-7khq>**Visit or Download**</a> 

#### LA Weather Data
<a href=https://api.wunderground.com/api/6c2a185280d4c455/history_20170101/q/CA/Los_Angeles.json>**Visit or Download**</a> 
